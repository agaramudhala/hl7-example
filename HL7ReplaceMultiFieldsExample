public class HL7ReplaceMultiFieldsExample {

    public static void main(String[] args) {
        String hl7Message = "MSH|^~\\&|OLD_SENDER|OLD_FACILITY|OLD_RECEIVER|OLD_FACILITY|20230209153025||ADT^A08|MSGID123456789|P|2.5|||EVN||20230209153030|||||";
        String newMSH7Value = "NEW_MESSAGE_TYPE";
        String newMSH10Value = "NEW_MSG_CONTROL_ID";
        String newEVN2Value = "NEW_EVENT_TYPE";
        String newPID5Value = "NEW_LAST_NAME";
        String newPID7Value = "NEW_DOB";
        String newPID8Value = "NEW_GENDER";
        String newPID11Value = "NEW_ADDRESS";
        String newPID17Value = "NEW_LANGUAGE";

        String newMessage = replaceFields(hl7Message, newMSH7Value, newMSH10Value, newEVN2Value, newPID5Value, newPID7Value, newPID8Value, newPID11Value, newPID17Value);
        System.out.println(newMessage);
    }

    private static String replaceFields(String hl7Message, String newMSH7Value, String newMSH10Value, String newEVN2Value, String newPID5Value,
                                        String newPID7Value, String newPID8Value, String newPID11Value, String newPID17Value) {
        String[] segments = hl7Message.split("\r");
        StringBuilder builder = new StringBuilder();

        for (String segment : segments) {
            String segmentType = segment.substring(0, 3);

            if (segmentType.equals("MSH")) {
                String[] fields = segment.split("\\|", -1);

                // Replace MSH-7 and MSH-10 fields
                fields[6] = newMSH7Value;
                fields[9] = newMSH10Value;

                // Reconstruct the MSH segment
                String newMSHSegment = String.join("|", fields);
                builder.append(newMSHSegment).append("\r");
            } else if (segmentType.equals("EVN")) {
                String[] fields = segment.split("\\|", -1);

                // Replace EVN-2 field
                fields[1] = newEVN2Value;

                // Reconstruct the EVN segment
                String newEVNSegment = String.join("|", fields);
                builder.append(newEVNSegment).append("\r");
            } else if (segmentType.equals("PID")) {
                String[] fields = segment.split("\\|", -1);

                // Replace PID-5, PID-7, PID-8, PID-11, and PID-17 fields
                fields[4] = newPID5Value;
                fields[6] = newPID7Value;
                fields[7] = newPID8Value;
                fields[10] = newPID11Value;
                fields[16] = newPID17Value;

                // Reconstruct the PID segment
                String newPIDSegment = String.join("|", fields);
                builder.append(newPIDSegment).append("\r");
            } else {
                builder.append(segment).append("\r");
            }
        }

        return builder.toString();
    }
}
